<!DOCTYPE html>
<html lang="es">

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <title>Formulario de Comentarios</title>
  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="/styles.css">

</head>

<body>


  <div class="theme-toggle">
    <button id="toggle-theme" aria-label="Toggle theme">
      <span id="theme-icon">üåû</span>
    </button>
  </div>
  <div class="container my-5">
    <div class="card p-4">
      <form id="comentariosForm" class="row g-3 needs-validation" novalidate>
        <div class="row mb-4">
          <div class="col-md-6 text-center">
            <img src="https://drive.google.com/thumbnail?sz=w500&id=1prfzE2760WH6XZ9kG4k0VO5CdxJKiLNo" alt="Encabezado"
              class="img-fluid" style="max-width: 200px; filter: drop-shadow(0px 0px 13px #ffffff)">
          </div>
          <div class="col-md-6 d-flex align-items-center justify-content-center text-center">
            <h3 class="fw-bold mb-0">ASOCIACI√ìN DE PROPIETARIOS Y VECINOS DE LA URBANIZACI√ìN<br>SANTA FE III ETAPA</h3>
          </div>
        </div>

        <h1 class="h4 text-center receipt-title mb-5">REGISTRO DE COMENTARIO</h1>

        <div class="row g-3">

          <div class="col-md-4">
            <div class="form-floating">
              <input type="number" class="form-control" id="cedula" name="cedula" placeholder="C√©dula"
                required>
              <label for="cedula"><i class="bi bi-person-vcard"></i> C√©dula</label>
              <div class="invalid-feedback">Por favor ingresa tu n√∫mero de c√©dula.</div>
            </div>
          </div>


        <div class="col-md-4">
          <div class="form-floating">
            <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Nombre"
              required>
            <label for="nombre">Nombre</label>
            <div class="invalid-feedback">Por favor ingresa tu nombre.</div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="form-floating">
            <input type="text" class="form-control" id="apellido" name="apellido" placeholder="Apellido"
              required>
            <label for="apellido">Apellido</label>
            <div class="invalid-feedback">Por favor ingresa tu apellido.</div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-floating">
            <input type="tel" class="form-control" id="telefono" name="telefono" placeholder="Tel√©fono"
              required>
            <label for="telefono">Tel√©fono</label>
            <div class="invalid-feedback">Por favor ingresa tu n√∫mero de tel√©fono.</div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-floating">
            <input type="email" class="form-control" id="correo" name="correo"
              placeholder="Correo electr√≥nico" required>
            <label for="correo">Correo electr√≥nico</label>
            <div class="invalid-feedback">Por favor ingresa un correo v√°lido.</div>
          </div>
        </div>

        <div class="col-12">
          <div class="form-floating">
            <textarea class="form-control" id="comentario" name="comentario" placeholder="Comentario"
              style="height: 120px;" required></textarea>
            <label for="comentario">Escribe tu comentario aqu√≠...</label>
            <div class="invalid-feedback">Por favor ingresa un comentario.</div>
          </div>
        </div>

        <div class="col-12 text-center">
          <button type="submit" class="btn btn-primary px-4" disabled
            style="background-color: var(--button-bg); color: var(--button-text);">Enviar Comentario</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="modalExito" tabindex="-1" aria-labelledby="modalExitoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="modalExitoLabel">Comentario Registrado</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          Comentario registrado con √©xito. <br> ¬°Gracias por darnos tu opini√≥n!
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-success" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  crossorigin="anonymous"></script>
  <script>
 
  /* boton modo oscuro */ 
  const toggleBtn = document.getElementById('toggle-theme');
  const icon = document.getElementById('theme-icon');

  // Cargar preferencia guardada
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') {
    document.documentElement.setAttribute('data-theme', 'dark');
    icon.textContent = 'üåô';
  }

  toggleBtn.addEventListener('click', () => {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    if (isDark) {
      document.documentElement.setAttribute('data-theme', 'light');
      localStorage.setItem('theme', 'light');
      icon.textContent = 'üåû';
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
      localStorage.setItem('theme', 'dark');
      icon.textContent = 'üåô';
    }
  });


  
    (() => {
      'use strict';
      const form = document.getElementById('comentariosForm');
      const submitBtn = form.querySelector('button[type="submit"]');

      // Inicialmente bot√≥n deshabilitado
      submitBtn.disabled = true;

      // Funci√≥n para chequear validez y habilitar/deshabilitar bot√≥n
      const validarFormulario = () => {
        submitBtn.disabled = !form.checkValidity();
      };

      // Escuchar cambios en todos los inputs y textarea
      form.querySelectorAll('input, textarea').forEach(input => {
        input.addEventListener('input', () => {
          validarFormulario();
          // Tambi√©n puedes remover la clase was-validated si quieres
          // form.classList.remove('was-validated');
        });
      });

      // Validaci√≥n Bootstrap para mostrar errores al enviar
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
          form.classList.add('was-validated');
          return;
        }
        event.preventDefault();

        // Desactivar bot√≥n y cambiar texto
        submitBtn.disabled = true;
        submitBtn.textContent = 'Enviando...';

        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => data[key] = value);

        google.script.run.withSuccessHandler(() => {
          // Mostrar modal de √©xito
          const modal = new bootstrap.Modal(document.getElementById('modalExito'));
          modal.show();

          // Resetear formulario
          form.reset();
          form.classList.remove('was-validated');

          // Restaurar bot√≥n
          submitBtn.disabled = true; // vuelve a deshabilitar porque formulario est√° vac√≠o
          submitBtn.textContent = 'Enviar Comentario';
        }).registrarComentario(data);
      });
    })();

  </script>

</body>

</html>